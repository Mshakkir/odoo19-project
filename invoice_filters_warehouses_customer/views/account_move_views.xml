<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- ============================================== -->
        <!-- Extend Invoice Tree View to Add Warehouse     -->
        <!-- ============================================== -->
        <record id="view_invoice_tree_inherit_warehouse_filter" model="ir.ui.view">
            <field name="name">account.move.tree.inherit.warehouse.filter</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_invoice_tree"/>
            <field name="arch" type="xml">

                <!-- Add Warehouse column after Name/Number -->
                <xpath expr="//field[@name='name']" position="after">
                    <field name="warehouse_id"
                           optional="show"
                           widget="many2one"
                           string="Warehouse"/>
                </xpath>

            </field>
        </record>

        <!-- ============================================== -->
        <!-- Enhanced Search/Filter View                    -->
        <!-- ============================================== -->
        <record id="view_account_invoice_filter_inherit_custom" model="ir.ui.view">
            <field name="name">account.move.filter.inherit.warehouse.customer</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_account_invoice_filter"/>
            <field name="arch" type="xml">

                <!-- Add Warehouse search field -->
                <xpath expr="//field[@name='name']" position="after">
                    <field name="warehouse_id"
                           string="Warehouse"
                           filter_domain="[('warehouse_id', 'ilike', self)]"/>
                </xpath>

                <!-- Add Warehouse Filters after the late filter -->
                <xpath expr="//filter[@name='late']" position="after">
                    <separator/>
                    <filter string="Dammam Warehouse"
                            name="filter_warehouse_dammam"
                            domain="[('warehouse_id.name', 'ilike', 'Dammam')]"
                            help="Show only Dammam warehouse invoices"/>

                    <filter string="Main Warehouse"
                            name="filter_warehouse_main"
                            domain="[('warehouse_id.name', 'ilike', 'MAIN')]"
                            help="Show only Main warehouse invoices"/>

                    <filter string="S00014 Warehouse"
                            name="filter_warehouse_s00014"
                            domain="[('warehouse_id.name', 'ilike', 'S00014')]"
                            help="Show only S00014 warehouse invoices"/>

                    <filter string="S00017 Warehouse"
                            name="filter_warehouse_s00017"
                            domain="[('warehouse_id.name', 'ilike', 'S00017')]"
                            help="Show only S00017 warehouse invoices"/>

                    <filter string="S00019 Warehouse"
                            name="filter_warehouse_s00019"
                            domain="[('warehouse_id.name', 'ilike', 'S00019')]"
                            help="Show only S00019 warehouse invoices"/>

                    <filter string="S00020 Warehouse"
                            name="filter_warehouse_s00020"
                            domain="[('warehouse_id.name', 'ilike', 'S00020')]"
                            help="Show only S00020 warehouse invoices"/>

                    <filter string="S00021 Warehouse"
                            name="filter_warehouse_s00021"
                            domain="[('warehouse_id.name', 'ilike', 'S00021')]"
                            help="Show only S00021 warehouse invoices"/>

                    <filter string="S00022 Warehouse"
                            name="filter_warehouse_s00022"
                            domain="[('warehouse_id.name', 'ilike', 'S00022')]"
                            help="Show only S00022 warehouse invoices"/>

                    <separator/>

                    <filter string="Has Warehouse"
                            name="filter_has_warehouse"
                            domain="[('warehouse_id', '!=', False)]"
                            help="Show only invoices with warehouse assigned"/>

                    <filter string="No Warehouse"
                            name="filter_no_warehouse"
                            domain="[('warehouse_id', '=', False)]"
                            help="Show only invoices without warehouse"/>
                </xpath>

                <!-- Add Customer Filters -->
                <xpath expr="//filter[@name='filter_no_warehouse']" position="after">
                    <separator/>

                    <filter string="Customer 1"
                            name="filter_customer_1"
                            domain="[('partner_id.name', 'ilike', 'customer 1')]"
                            help="Show only Customer 1 invoices"/>

                    <filter string="Customer 2"
                            name="filter_customer_2"
                            domain="[('partner_id.name', 'ilike', 'customer 2')]"
                            help="Show only Customer 2 invoices"/>

                    <filter string="Customer 3"
                            name="filter_customer_3"
                            domain="[('partner_id.name', 'ilike', 'customer 3')]"
                            help="Show only Customer 3 invoices"/>

                    <filter string="Customer 4"
                            name="filter_customer_4"
                            domain="[('partner_id.name', 'ilike', 'customer 4')]"
                            help="Show only Customer 4 invoices"/>

                    <filter string="Test Customer"
                            name="filter_test_customer"
                            domain="[('partner_id.name', 'ilike', 'Test Custo')]"
                            help="Show only Test Customer invoices"/>
                </xpath>

                <!-- Add Group By Warehouse and Customer inside the existing group -->
                <xpath expr="//filter[@name='group_by_sequence_prefix']" position="after">
                    <separator/>
                    <filter string="Warehouse"
                            name="group_by_warehouse"
                            context="{'group_by': 'warehouse_id'}"
                            help="Group invoices by warehouse"/>
                </xpath>

            </field>
        </record>

        <!-- ============================================== -->
        <!-- Add Warehouse to Invoice Form View            -->
        <!-- ============================================== -->
        <record id="view_move_form_inherit_warehouse_filter" model="ir.ui.view">
            <field name="name">account.move.form.inherit.warehouse.filter</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_form"/>
            <field name="arch" type="xml">

                <!-- Add Warehouse field after invoice_date -->
                <xpath expr="//field[@name='invoice_date']" position="after">
                    <field name="warehouse_id"
                           options="{'no_create': True, 'no_open': True}"
                           invisible="move_type not in ['out_invoice', 'out_refund']"/>
                </xpath>

            </field>
        </record>

    </data>
</odoo>