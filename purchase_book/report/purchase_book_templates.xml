<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Main Purchase Book Report Template -->
        <template id="report_purchase_book_document">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <!-- Use basic_layout instead of external_layout to avoid default header -->
                    <t t-call="web.basic_layout">
                        <div class="page">
                            <!-- Custom Header -->
                            <div class="header" style="border:2px solid white; border-radius: 6px; background: white; margin-bottom: 25px; padding: 15px 0;">
                                <table style="width: 100%; border-collapse: collapse; border:none; margin-bottom: 0px;">
                                    <tr style="border:2px solid white;">
                                        <td style="width: 50%; padding: 10px 0px; text-align: left; vertical-align: middle; border: none;padding-bottom:0px;">
                                            <div style="color: #8B1538; font-size: 14px; font-weight: bold; text-transform: uppercase;">
                                                SAMEER SHARAF AL OTAIBI TRADING COMPANY
                                            </div>
                                        </td>
                                        <td style="width: 50%; padding: 10px 0px; text-align: right; vertical-align: middle; border: none;">
                                            <div style="color: #8B1538; font-size: 16px; font-weight: 900; direction: rtl;padding-bottom:0px;" class="ar">
                                                شركة سمير شرف العتيبي التجارية
                                            </div>
                                        </td>
                                    </tr>
                                </table>

                                <table style="width: 100%; border-collapse: collapse;">
                                    <tr style="border:2px solid white;">
                                        <td style="width: 33%; text-align: left; font-size: 14px; color: #333; vertical-align: middle;
                                        padding: 0px 0px 10px 0px; border-top: 1px solid #ddd; border-bottom: 2px solid #8B1538;">
                                            <div style="line-height: 1.6; font-weight: 500; margin-top: 10px;">
                                                C.R. 4030216154<br/>
                                                VAT Regd: 311299944700003
                                            </div>
                                        </td>

                                        <td style="width: 34%; text-align: center; vertical-align: middle; padding: 5px 10px;
                                        border-top: 1px solid #ddd; border-bottom: 2px solid #8B1538;">
                                            <t t-if="o.company_id.logo">
                                                <img t-att-src="image_data_uri(o.company_id.logo)"
                                                     style="max-height: 90px; max-width: 100%; object-fit: contain;"/>
                                            </t>
                                        </td>

                                        <td style="width: 33%; text-align: right; font-size: 14px; color: #333; vertical-align: middle;
                                        direction: rtl; padding: 0px 0px 10px 0px; border-top: 1px solid #ddd; border-bottom: 2px solid #8B1538;">
                                            <div style="line-height: 1.6; font-weight: 900; text-align: right; direction: rtl; margin-top: 10px;" class="ar">
                                                س.ت: ٤٠٣٠٢١٦١٥٤<br/>
                                                الرقم الضريبي: ٣١١٢٩٩٩٤٤٧٠٠٠٠٣
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>

                            <!-- Report Title -->
                            <div class="text-center mb-4">
                                <h3 style="margin: 20px 0 10px 0; font-size: 20px; font-weight: bold;">
                                    <t t-if="o.report_type == 'purchase'">Purchase Book Report</t>
                                    <t t-if="o.report_type == 'return'">Purchase Return Book Report</t>
                                    <t t-if="o.report_type == 'both'">Purchase &amp; Purchase Return Book Report</t>
                                </h3>
                                <p style="margin: 5px 0; font-size: 14px;">
                                    <strong>Date Range: </strong>
                                    <span t-esc="o.date_from.strftime('%d-%m-%Y')"/> to <span t-esc="o.date_to.strftime('%d-%m-%Y')"/>
                                </p>
                            </div>

                            <!-- Purchase Report -->
                            <t t-if="o.report_type == 'purchase'">
                                <t t-set="data" t-value="o._get_report_data()"/>
                                <t t-call="purchase_book.purchase_table_template"/>
                            </t>

                            <!-- Purchase Return Report -->
                            <t t-if="o.report_type == 'return'">
                                <t t-set="data" t-value="o._get_report_data()"/>
                                <t t-call="purchase_book.return_table_template"/>
                            </t>

                            <!-- Combined Report -->
                            <t t-if="o.report_type == 'both'">
                                <t t-set="data" t-value="o._get_report_data()"/>
                                <t t-call="purchase_book.combined_table_template"/>
                            </t>

                        </div>
                    </t>
                </t>
            </t>
        </template>

        <!-- Purchase Table Template -->
        <template id="purchase_table_template">
            <table class="table table-sm table-bordered">
                <thead style="background-color: #e9ecef;">
                    <tr>
                        <th>Date</th>
                        <th>Vendor</th>
                        <th>Invoice</th>
                        <th class="text-right">Gross</th>
                        <th class="text-right">Tr. Disc</th>
                        <th class="text-right">Net Total</th>
                        <th class="text-right">Ad. Disc</th>
                        <th class="text-right">Ad. Cost</th>
                        <th class="text-right">Round Off</th>
                        <th class="text-right">Adj. Amt</th>
                        <th class="text-right">Tax Amt</th>
                        <th class="text-right">Grand Total</th>
                    </tr>
                </thead>
                <tbody>
                    <t t-set="total_gross" t-value="0"/>
                    <t t-set="total_trade_disc" t-value="0"/>
                    <t t-set="total_net" t-value="0"/>
                    <t t-set="total_ad_disc" t-value="0"/>
                    <t t-set="total_ad_cost" t-value="0"/>
                    <t t-set="total_round" t-value="0"/>
                    <t t-set="total_adj" t-value="0"/>
                    <t t-set="total_tax" t-value="0"/>
                    <t t-set="total_grand" t-value="0"/>

                    <t t-foreach="data" t-as="line">
                        <tr>
                            <td><span t-esc="line['date']"/></td>
                            <td><span t-esc="line['vendor']"/></td>
                            <td><span t-esc="line['invoice_ref']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['gross']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['trade_disc']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['net_total']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['add_disc']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['add_cost']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['round_off']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['adj_amount']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['tax_amount']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['grand_total']"/></td>
                        </tr>
                        <t t-set="total_gross" t-value="total_gross + line['gross']"/>
                        <t t-set="total_trade_disc" t-value="total_trade_disc + line['trade_disc']"/>
                        <t t-set="total_net" t-value="total_net + line['net_total']"/>
                        <t t-set="total_ad_disc" t-value="total_ad_disc + line['add_disc']"/>
                        <t t-set="total_ad_cost" t-value="total_ad_cost + line['add_cost']"/>
                        <t t-set="total_round" t-value="total_round + line['round_off']"/>
                        <t t-set="total_adj" t-value="total_adj + line['adj_amount']"/>
                        <t t-set="total_tax" t-value="total_tax + line['tax_amount']"/>
                        <t t-set="total_grand" t-value="total_grand + line['grand_total']"/>
                    </t>
                </tbody>
                <tfoot style="background-color: #f8f9fa; font-weight: bold;">
                    <tr>
                        <td colspan="3" class="text-right">Grand Total</td>
                        <td class="text-right"><span t-esc="'%.2f' % total_gross"/></td>
                        <td class="text-right"><span t-esc="'%.2f' % total_trade_disc"/></td>
                        <td class="text-right"><span t-esc="'%.2f' % total_net"/></td>
                        <td class="text-right"><span t-esc="'%.2f' % total_ad_disc"/></td>
                        <td class="text-right"><span t-esc="'%.2f' % total_ad_cost"/></td>
                        <td class="text-right"><span t-esc="'%.2f' % total_round"/></td>
                        <td class="text-right"><span t-esc="'%.2f' % total_adj"/></td>
                        <td class="text-right"><span t-esc="'%.2f' % total_tax"/></td>
                        <td class="text-right"><span t-esc="'%.2f' % total_grand"/></td>
                    </tr>
                </tfoot>
            </table>
        </template>

        <!-- Return Table Template -->
        <template id="return_table_template">
            <table class="table table-sm table-bordered">
                <thead style="background-color: #e9ecef;">
                    <tr>
                        <th>Date</th>
                        <th>Vendor</th>
                        <th>Return Ref</th>
                        <th class="text-right">Gross</th>
                        <th class="text-right">Tr. Disc</th>
                        <th class="text-right">Net Total</th>
                        <th class="text-right">Ad. Disc</th>
                        <th class="text-right">Ad. Cost</th>
                        <th class="text-right">Round Off</th>
                        <th class="text-right">Adj. Amt</th>
                        <th class="text-right">Tax Amt</th>
                        <th class="text-right">Grand Total</th>
                    </tr>
                </thead>
                <tbody>
                    <t t-set="total_gross" t-value="0"/>
                    <t t-set="total_trade_disc" t-value="0"/>
                    <t t-set="total_net" t-value="0"/>
                    <t t-set="total_ad_disc" t-value="0"/>
                    <t t-set="total_ad_cost" t-value="0"/>
                    <t t-set="total_round" t-value="0"/>
                    <t t-set="total_adj" t-value="0"/>
                    <t t-set="total_tax" t-value="0"/>
                    <t t-set="total_grand" t-value="0"/>

                    <t t-foreach="data" t-as="line">
                        <tr>
                            <td><span t-esc="line['date']"/></td>
                            <td><span t-esc="line['vendor']"/></td>
                            <td><span t-esc="line['invoice_ref']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['gross']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['trade_disc']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['net_total']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['add_disc']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['add_cost']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['round_off']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['adj_amount']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['tax_amount']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['grand_total']"/></td>
                        </tr>
                        <t t-set="total_gross" t-value="total_gross + line['gross']"/>
                        <t t-set="total_trade_disc" t-value="total_trade_disc + line['trade_disc']"/>
                        <t t-set="total_net" t-value="total_net + line['net_total']"/>
                        <t t-set="total_ad_disc" t-value="total_ad_disc + line['add_disc']"/>
                        <t t-set="total_ad_cost" t-value="total_ad_cost + line['add_cost']"/>
                        <t t-set="total_round" t-value="total_round + line['round_off']"/>
                        <t t-set="total_adj" t-value="total_adj + line['adj_amount']"/>
                        <t t-set="total_tax" t-value="total_tax + line['tax_amount']"/>
                        <t t-set="total_grand" t-value="total_grand + line['grand_total']"/>
                    </t>
                </tbody>
                <tfoot style="background-color: #f8f9fa; font-weight: bold;">
                    <tr>
                        <td colspan="3" class="text-right">Grand Total</td>
                        <td class="text-right"><span t-esc="'%.2f' % total_gross"/></td>
                        <td class="text-right"><span t-esc="'%.2f' % total_trade_disc"/></td>
                        <td class="text-right"><span t-esc="'%.2f' % total_net"/></td>
                        <td class="text-right"><span t-esc="'%.2f' % total_ad_disc"/></td>
                        <td class="text-right"><span t-esc="'%.2f' % total_ad_cost"/></td>
                        <td class="text-right"><span t-esc="'%.2f' % total_round"/></td>
                        <td class="text-right"><span t-esc="'%.2f' % total_adj"/></td>
                        <td class="text-right"><span t-esc="'%.2f' % total_tax"/></td>
                        <td class="text-right"><span t-esc="'%.2f' % total_grand"/></td>
                    </tr>
                </tfoot>
            </table>
        </template>

        <!-- Combined Table Template -->
        <template id="combined_table_template">
            <table class="table table-sm table-bordered">
                <thead style="background-color: #e9ecef;">
                    <tr>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Vendor</th>
                        <th>Ref</th>
                        <th class="text-right">Gross</th>
                        <th class="text-right">Tr. Disc</th>
                        <th class="text-right">Net Total</th>
                        <th class="text-right">Tax Amt</th>
                        <th class="text-right">Cost</th>
                        <th class="text-right">Adj</th>
                        <th class="text-right">Net Amt</th>
                    </tr>
                </thead>
                <tbody>
                    <t t-set="total_gross" t-value="0"/>
                    <t t-set="total_trade_disc" t-value="0"/>
                    <t t-set="total_net" t-value="0"/>
                    <t t-set="total_tax" t-value="0"/>
                    <t t-set="total_cost" t-value="0"/>
                    <t t-set="total_adj" t-value="0"/>
                    <t t-set="total_grand" t-value="0"/>

                    <t t-foreach="data" t-as="line">
                        <tr>
                            <td><span t-esc="line['date']"/></td>
                            <td>
                                <span t-if="line.get('type') == 'Purchase'" class="badge badge-success">Purchase</span>
                                <span t-if="line.get('type') == 'Return'" class="badge badge-danger">Return</span>
                            </td>
                            <td><span t-esc="line['vendor']"/></td>
                            <td><span t-esc="line['invoice_ref']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['gross']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['trade_disc']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['net_total']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['tax_amount']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['add_cost']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['adj_amount']"/></td>
                            <td class="text-right"><span t-esc="'%.2f' % line['grand_total']"/></td>
                        </tr>
                        <t t-set="total_gross" t-value="total_gross + line['gross']"/>
                        <t t-set="total_trade_disc" t-value="total_trade_disc + line['trade_disc']"/>
                        <t t-set="total_net" t-value="total_net + line['net_total']"/>
                        <t t-set="total_tax" t-value="total_tax + line['tax_amount']"/>
                        <t t-set="total_cost" t-value="total_cost + line['add_cost']"/>
                        <t t-set="total_adj" t-value="total_adj + line['adj_amount']"/>
                        <t t-set="total_grand" t-value="total_grand + line['grand_total']"/>
                    </t>
                </tbody>
                <tfoot style="background-color: #f8f9fa; font-weight: bold;">
                    <tr>
                        <td colspan="4" class="text-right">Grand Total</td>
                        <td class="text-right"><span t-esc="'%.2f' % total_gross"/></td>
                        <td class="text-right"><span t-esc="'%.2f' % total_trade_disc"/></td>
                        <td class="text-right"><span t-esc="'%.2f' % total_net"/></td>
                        <td class="text-right"><span t-esc="'%.2f' % total_tax"/></td>
                        <td class="text-right"><span t-esc="'%.2f' % total_cost"/></td>
                        <td class="text-right"><span t-esc="'%.2f' % total_adj"/></td>
                        <td class="text-right"><span t-esc="'%.2f' % total_grand"/></td>
                    </tr>
                </tfoot>
            </table>
        </template>

    </data>
</odoo>