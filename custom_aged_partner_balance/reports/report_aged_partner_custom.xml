<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Option 4: Create custom paper format to control margins and header/footer -->

    <!-- Define custom paper format -->
    <record id="paperformat_aged_partner_custom" model="report.paperformat">
        <field name="name">Aged Partner Balance Custom Format</field>
        <field name="default" eval="True"/>
        <field name="format">A4</field>
        <field name="page_height">0</field>
        <field name="page_width">0</field>
        <field name="orientation">Landscape</field>
        <field name="margin_top">15</field>
        <field name="margin_bottom">15</field>
        <field name="margin_left">10</field>
        <field name="margin_right">10</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">10</field>
        <field name="dpi">90</field>
    </record>

    <!-- Find and update the report action to use custom paper format -->
    <record id="accounting_pdf_reports.action_report_aged_partner_balance" model="ir.actions.report">
        <field name="paperformat_id" ref="paperformat_aged_partner_custom"/>
    </record>

    <!-- Main report template with minimal header -->
    <template id="report_agedpartnerbalance_minimal" inherit_id="accounting_pdf_reports.report_agedpartnerbalance">

        <!-- Replace entire template structure -->
        <xpath expr="//t[@t-call='web.html_container']" position="replace">
            <t t-call="web.html_container">
                <!-- Use basic_layout for no header/footer -->
                <t t-call="web.basic_layout">
                    <div class="page" style="padding-top: 20px;">

                        <!-- Custom Header -->
                        <div class="header" style="border:2px solid white; border-radius: 6px; background: white; margin-bottom: 25px; padding: 15px 0;">

                            <!-- Company Names in One Row -->
                            <table style="width: 100%; border-collapse: collapse; border:none; margin-bottom: 10px;">
                                <tr>
                                    <td style="width: 50%; padding: 10px 0px; text-align: left; vertical-align: middle; border: none;">
                                        <div style="color: #8B1538; font-size: 16px; font-weight: bold; text-transform: uppercase;">
                                            SAMEER SHARAF AL OTAIBI TRADING COMPANY
                                        </div>
                                    </td>
                                    <td style="width: 50%; padding: 10px 0px; text-align: right; vertical-align: middle; border: none;">
                                        <div style="color: #8B1538; font-size: 18px; font-weight: 900; direction: rtl;" class="ar">
                                            شركة سمير شرف العتيبي التجارية
                                        </div>
                                    </td>
                                </tr>
                            </table>

                            <!-- Details and Logo Row -->
                            <table style="width: 100%; border-collapse: collapse;">
                                <tr>
                                    <!-- Left Column: English Info -->
                                    <td style="width: 33%; text-align: left; font-size: 14px; color: #333; vertical-align: middle;
                                    padding: 10px 0px; border-top: 1px solid #ddd; border-bottom: 2px solid #8B1538;">
                                        <div style="line-height: 1.6; font-weight: 500;">
                                            C.R. 4030216154<br/>
                                            VAT Regd: 311299944700003
                                        </div>
                                    </td>

                                    <!-- Center Column: Company Logo -->
                                    <td style="width: 34%; text-align: center; vertical-align: middle; padding: 5px 10px;
                                    border-top: 1px solid #ddd; border-bottom: 2px solid #8B1538;">
                                        <img t-att-src="request.httprequest.host_url + 'custom_sa_quotation/static/src/img/faakart_logo.png'"
                                             style="max-height: 80px; max-width: 100%; object-fit: contain;"/>
                                    </td>

                                    <!-- Right Column: Arabic Info -->
                                    <td style="width: 33%; text-align: right; font-size: 14px; color: #333; vertical-align: middle;
                                    direction: rtl; padding: 10px 0px; border-top: 1px solid #ddd; border-bottom: 2px solid #8B1538;">
                                        <div style="line-height: 1.6; font-weight: 900; text-align: right; direction: rtl;" class="ar">
                                            س.ت: ٤٠٣٠٢١٦١٥٤<br/>
                                            الرقم الضريبي: ٣١١٢٩٩٩٤٤٧٠٠٠٠٣
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <!-- Report Title and Date -->
                        <div class="row" style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid #875A7B;">
                            <div class="col-8">
                                <h3 style="margin: 0; color: #875A7B; font-weight: bold;">
                                    Aged Partner Balance Report
                                </h3>
                            </div>
                            <div class="col-4 text-end">
                                <p style="margin: 0;">
                                    <strong>Report Date:</strong><br/>
                                    <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/>
                                </p>
                            </div>
                        </div>

                        <!-- Report Parameters -->
                        <div class="row" style="margin-bottom: 15px;">
                            <div class="col-3">
                                <strong>Company:</strong>
                                <p t-esc="res_company.name" style="margin: 5px 0;"/>
                            </div>
                            <div class="col-3">
                                <strong>Start Date:</strong>
                                <p t-esc="data['date_from']" style="margin: 5px 0;"/>
                            </div>
                            <div class="col-3">
                                <strong>Period Length (days):</strong>
                                <p t-esc="data['period_length']" style="margin: 5px 0;"/>
                            </div>
                            <div class="col-3">
                                <strong>Generated By:</strong>
                                <p t-esc="user.name" style="margin: 5px 0;"/>
                            </div>
                        </div>

                        <div class="row" style="margin-bottom: 25px;">
                            <div class="col-3">
                                <strong>Partner's:</strong>
                                <p style="margin: 5px 0;">
                                    <span t-if="data['result_selection'] == 'customer'">Receivable Accounts</span>
                                    <span t-if="data['result_selection'] == 'supplier'">Payable Accounts</span>
                                    <span t-if="data['result_selection'] == 'customer_supplier'">Receivable and Payable Accounts</span>
                                </p>
                            </div>
                            <div class="col-3">
                                <strong>Target Moves:</strong>
                                <p style="margin: 5px 0;">
                                    <span t-if="data['target_move'] == 'all'">All Entries</span>
                                    <span t-if="data['target_move'] == 'posted'">All Posted Entries</span>
                                </p>
                            </div>
                            <div class="col-3">
                                <strong>Total Partners:</strong>
                                <p t-esc="total_partners or len(get_partner_lines)" style="margin: 5px 0;"/>
                            </div>
                            <div class="col-3">
                                <strong>Partners with Overdue:</strong>
                                <p t-esc="partners_with_overdue or 0" style="margin: 5px 0;"/>
                            </div>
                        </div>

                        <!-- Main Table -->
                        <table class="table table-sm table-bordered" style="margin-bottom: 25px;">
                            <thead style="background-color: #875A7B; color: white;">
                                <tr>
                                    <th style="padding: 8px;">Partners</th>
                                    <th style="padding: 8px;">Email</th>
                                    <th style="padding: 8px;">Phone</th>
                                    <th style="padding: 8px;">City</th>
                                    <th class="text-end" style="padding: 8px;">Not due</th>
                                    <th class="text-end" style="padding: 8px;">
                                        <span t-esc="data['4']['name']"/>
                                    </th>
                                    <th class="text-end" style="padding: 8px;">
                                        <span t-esc="data['3']['name']"/>
                                    </th>
                                    <th class="text-end" style="padding: 8px;">
                                        <span t-esc="data['2']['name']"/>
                                    </th>
                                    <th class="text-end" style="padding: 8px;">
                                        <span t-esc="data['1']['name']"/>
                                    </th>
                                    <th class="text-end" style="padding: 8px;">
                                        <span t-esc="data['0']['name']"/>
                                    </th>
                                    <th class="text-end" style="padding: 8px;">Total</th>
                                </tr>
                                <tr t-if="get_partner_lines" style="background-color: #f0f0f0; font-weight: bold;">
                                    <th style="padding: 8px;">Account Total</th>
                                    <th colspan="3" class="text-center" style="padding: 8px;">Details</th>
                                    <th class="text-end" style="padding: 8px;">
                                        <span t-esc="get_direction[6]"
                                              t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                    </th>
                                    <th class="text-end" style="padding: 8px;">
                                        <span t-esc="get_direction[4]"
                                              t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                    </th>
                                    <th class="text-end" style="padding: 8px;">
                                        <span t-esc="get_direction[3]"
                                              t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                    </th>
                                    <th class="text-end" style="padding: 8px;">
                                        <span t-esc="get_direction[2]"
                                              t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                    </th>
                                    <th class="text-end" style="padding: 8px;">
                                        <span t-esc="get_direction[1]"
                                              t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                    </th>
                                    <th class="text-end" style="padding: 8px;">
                                        <span t-esc="get_direction[0]"
                                              t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                    </th>
                                    <th class="text-end" style="padding: 8px;">
                                        <span t-esc="get_direction[5]"
                                              t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr t-foreach="get_partner_lines" t-as="partner">
                                    <td style="padding: 6px;">
                                        <span t-esc="partner['name']"/>
                                    </td>
                                    <td style="padding: 6px;">
                                        <span t-esc="partner.get('email', '')"/>
                                    </td>
                                    <td style="padding: 6px;">
                                        <span t-esc="partner.get('phone', '')"/>
                                    </td>
                                    <td style="padding: 6px;">
                                        <span t-esc="partner.get('city', '')"/>
                                    </td>
                                    <td class="text-end" style="padding: 6px;">
                                        <span t-esc="partner['direction']"
                                              t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                    </td>
                                    <td class="text-end" style="padding: 6px;">
                                        <span t-esc="partner['4']"
                                              t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                    </td>
                                    <td class="text-end" style="padding: 6px;">
                                        <span t-esc="partner['3']"
                                              t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                    </td>
                                    <td class="text-end" style="padding: 6px;">
                                        <span t-esc="partner['2']"
                                              t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                    </td>
                                    <td class="text-end" style="padding: 6px;">
                                        <span t-esc="partner['1']"
                                              t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                    </td>
                                    <td class="text-end" style="padding: 6px;">
                                        <span t-esc="partner['0']"
                                              t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                    </td>
                                    <td class="text-end" style="padding: 6px; font-weight: bold;">
                                        <span t-esc="partner['total']"
                                              t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Aging Analysis Section -->
                        <div class="row" style="margin-top: 30px;" t-if="percentage_breakdown">
                            <div class="col-12">
                                <h4 style="color: #875A7B; margin-bottom: 15px;">Aging Analysis Summary</h4>
                                <table class="table table-sm table-bordered">
                                    <thead style="background-color: #875A7B; color: white;">
                                        <tr>
                                            <th style="padding: 8px;">Period</th>
                                            <th class="text-end" style="padding: 8px;">Amount</th>
                                            <th class="text-end" style="padding: 8px;">Percentage</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td style="padding: 6px;">Not Due</td>
                                            <td class="text-end" style="padding: 6px;">
                                                <span t-esc="get_direction[6]"
                                                      t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                            </td>
                                            <td class="text-end" style="padding: 6px;">
                                                <span t-esc="'%.2f' % percentage_breakdown.get('not_due', 0)"/>%
                                            </td>
                                        </tr>
                                        <tr t-foreach="range(5)" t-as="period_idx">
                                            <td style="padding: 6px;">
                                                <span t-esc="data[str(4-period_idx)]['name']"/>
                                            </td>
                                            <td class="text-end" style="padding: 6px;">
                                                <span t-esc="get_direction[4-period_idx]"
                                                      t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                            </td>
                                            <td class="text-end" style="padding: 6px;">
                                                <span t-esc="'%.2f' % percentage_breakdown.get('period_' + str(4-period_idx), 0)"/>%
                                            </td>
                                        </tr>
                                        <tr style="font-weight: bold; background-color: #f0f0f0;">
                                            <td style="padding: 6px;">Total</td>
                                            <td class="text-end" style="padding: 6px;">
                                                <span t-esc="get_direction[5]"
                                                      t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                            </td>
                                            <td class="text-end" style="padding: 6px;">100.00%</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Custom Footer inside page -->
                        <div class="row" style="margin-top: 30px; border-top: 2px solid #875A7B; padding-top: 15px;">
                            <div class="col-6">
                                <small class="text-muted">
                                    <strong t-esc="res_company.name"/> |
                                    <span t-esc="res_company.phone or ''"/>
                                </small>
                            </div>
                            <div class="col-6 text-end">
                                <small class="text-muted">
                                    Generated by <span t-esc="user.name"/> on
                                    <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/>
                                </small>
                            </div>
                        </div>

                    </div>
                </t>
            </t>
        </xpath>

    </template>

</odoo>