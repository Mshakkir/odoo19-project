<?xml version="1.0" encoding="utf-8"?>
<templates xml:space="preserve">

    <t t-name="rack_list.FilterBar">
        <div class="rack_list_filter_bar" t-on-keydown="onKeyDown">

            <!-- ── Product autocomplete ──────────────────────────────────── -->
            <div class="rack_product_dropdown_wrap">
                <div class="rack_product_input_wrap">
                    <input
                        type="text"
                        class="rack_filter_input o_input"
                        placeholder="Product name or code"
                        t-att-value="state.productFilter"
                        t-on-input="onProductInput"
                        autocomplete="off"
                    />
                    <span t-if="state.productFilter"
                          class="rack_product_clear"
                          t-on-click="clearProduct">✕</span>
                </div>

                <!-- Live suggestions list -->
                <div class="rack_product_dropdown" t-if="state.productDropdownOpen and state.productSuggestions.length">
                    <t t-foreach="state.productSuggestions" t-as="s" t-key="s.id">
                        <div class="rack_product_option" t-on-click="() => this.selectProduct(s)">
                            <span class="rack_product_code" t-if="s.code">[<t t-esc="s.code"/>]</span>
                            <span class="rack_product_name"><t t-esc="s.name"/></span>
                        </div>
                    </t>
                </div>
            </div>

            <!-- ── Location searchable dropdown ──────────────────────────── -->
            <div class="rack_loc_dropdown_wrap">
                <div class="rack_loc_trigger o_input" t-on-click="openLocationDropdown">
                    <span class="rack_loc_label" t-if="state.selectedLocationName">
                        <t t-esc="state.selectedLocationName"/>
                    </span>
                    <span class="rack_loc_placeholder" t-else="">Location</span>
                    <span class="rack_loc_caret">▾</span>
                    <span t-if="state.selectedLocationName"
                          class="rack_loc_clear"
                          t-on-click.stop="clearLocation">✕</span>
                </div>
                <div class="rack_loc_dropdown" t-if="state.locationDropdownOpen">
                    <div class="rack_loc_search_wrap">
                        <input type="text" class="rack_loc_search o_input"
                               placeholder="Search location..."
                               t-att-value="state.locationSearch"
                               t-on-input="onLocationSearchInput"
                               t-on-click.stop=""
                               t-on-keydown="onLocationKeyDown"/>
                    </div>
                    <div class="rack_loc_options">
                        <div class="rack_loc_option rack_loc_all"
                             t-on-click="() => this.selectLocation(null)">All Locations</div>
                        <t t-foreach="state.filteredLocations" t-as="loc" t-key="loc.id">
                            <div class="rack_loc_option"
                                 t-att-class="{ 'rack_loc_selected': state.locationId == loc.id }"
                                 t-on-click="() => this.selectLocation(loc)">
                                <t t-esc="loc.name"/>
                            </div>
                        </t>
                        <div class="rack_loc_empty"
                             t-if="state.filteredLocations.length === 0">No locations found</div>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" t-on-click="onApply">Apply</button>
            <button class="btn btn-secondary" t-on-click="onClear">Clear</button>
        </div>
    </t>

    <t t-name="rack_list.ListRenderer"
       t-inherit="web.ListRenderer"
       t-inherit-mode="primary">
        <xpath expr="//table" position="before">
            <RackListFilterBar
                applyFilters.bind="applyRackFilters"
                clearFilters.bind="clearRackFilters"
            />
        </xpath>
    </t>

    <t t-name="rack_list.ListController"
       t-inherit="web.ListView"
       t-inherit-mode="primary">
    </t>

</templates>