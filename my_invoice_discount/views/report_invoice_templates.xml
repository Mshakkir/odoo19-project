<odoo>
    <template id="custom_invoice_report" inherit_id="l10n_sa.l10n_sa_report_invoice_document">
        <xpath expr="//t[@t-call='web.external_layout']" position="replace">
            <t t-call="web.html_container">
                <style>
                    @page {
                        margin-top: 30mm;
                        margin-bottom: 30mm;
                    }
                </style>

                <t t-foreach="docs" t-as="o">
                    <div class="page">
                        <!-- ===== Header ===== -->
                        <div class="header" style="display:flex; padding:0; border:none; background:white; margin-bottom:0;">
                            <table style="width:100%; border:none;">
                                <tr>
                                    <!-- Left Side (English) -->
                                    <td style="width:33%; text-align:left; padding-right:10px;">
                                        <div style="font-weight:700; font-size:16px; color:#800000;">
                                            SAMEER SHARAF AL OTAIBI TRADING COMPANY
                                        </div>
                                        <div style="line-height:1.5; font-size:12px;">
                                            C.R. 4030216154<br/>
                                            VAT Regd: 311299944700003<br/>
                                            Al Anwar Centre, Showroom No. 12,<br/>
                                            Baladiya Street, Jeddah 23334 - Saudi Arabia<br/>
                                            Tel: 0536122833<br/>
                                            Email: ssaoe.jeddah@gmail.com
                                        </div>
                                    </td>

                                    <!-- Center (Logo) -->
                                    <td style="width:33%; text-align:center; padding:0 15px;">
                                        <t t-if="o.company_id.logo">
                                            <img t-att-src="image_data_uri(o.company_id.logo)"
                                                 style="max-height:120px; max-width:100%; object-fit:contain;"/>
                                        </t>
                                    </td>

                                    <!-- Right Side (Arabic) -->
                                    <td style="width:33%; text-align:right; direction:rtl; padding-left:10px;">
                                        <div style="font-weight:900; font-size:18px; color:#800000; font-family:'NotoNaskhArabic';">
                                            شركة سمير شرف العتيبي التجارية
                                        </div>
                                        <div style="line-height:1.5; font-size:12px; font-family:'NotoNaskhArabic';">
                                            ٤٠٣٠٢١٦١٥٤ :س.ت<br/>
                                            ٣١١٢٩٩٩٤٤٧٠٠٠٠٣ :الرقم الضريبي<br/>
                                            مركز الأنوار، رقم محل ١٢<br/>
                                            شارع البلدية، جدة ٢٣٣٣٤ - المملكة العربية السعودية<br/>
                                            ٠٥٣٦١٢٢٨٣٣ :هاتف<br/>
                                            ssaoe.jeddah@gmail.com :البريد الإلكتروني
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <!-- ===== Invoice Layout ===== -->
                    <t t-call="web.external_layout">

                        <!-- Title -->
                        <div style="padding-top:10px;">
                            <div style="background-color:#800000; color:white; padding:6px; text-align:center; margin-bottom:10px; font-weight:bold; font-size:15px;">
                                Tax Invoice / فاتورة ضريبية
                            </div>
                        </div>

                        <!-- Customer Info -->
                        <div style="border:1px solid #999; margin-bottom:10px; font-size:12px;">
                            <table style="width:100%; border-collapse:collapse;">
                                <tr style="background-color:#d3d3d3;">
                                    <td colspan="2" style="padding:4px 8px; font-weight:bold;">
                                        Sold To / اسم العميل
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2" style="padding:6px 10px;">
                                        <strong><t t-esc="o.partner_id.name"/></strong><br/><br/>
                                        <strong>VAT NO :</strong> <t t-esc="o.partner_id.vat or 'N/A'"/>
                                    </td>
                                </tr>
                            </table>

                            <!-- Invoice Info Row -->
                            <table style="width:100%; border-top:1px solid #999; background-color:#fff; font-size:12px; border-collapse:collapse;">
                                <tr>
                                    <td style="border:1px solid #000; padding:4px;">
                                        Inv # : <t t-esc="o.name"/>
                                    </td>
                                    <td style="border:1px solid #000; padding:4px;">
                                        Date : <t t-esc="o.invoice_date.strftime('%d-%b-%Y') if o.invoice_date else ''"/>
                                    </td>
                                    <td style="border:1px solid #000; padding:4px;">
                                        Terms : <t t-esc="o.invoice_payment_term_id.name or ''"/>
                                    </td>
                                    <td style="border:1px solid #000; padding:4px;">
                                        Delivery Note : <t t-esc="o.invoice_origin or ''"/>
                                    </td>
                                    <td style="border:1px solid #000; padding:4px;">
                                        P.O No : <t t-esc="o.ref or ''"/>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <!-- Items Table -->
                        <table width="100%" border="1" style="border-collapse:collapse; font-size:13px; text-align:center;">
                            <thead style="background-color:#d3d3d3; font-size:13px; font-weight:bold;">
                                <tr>
                                    <th>S.N</th>
                                    <th>Item / Description</th>
                                    <th>QTY</th>
                                    <th>Unit</th>
                                    <th>S.Rate</th>
                                    <th>Disc</th>
                                    <th>Amount</th>
                                    <th>VAT%</th>
                                    <th>VAT</th>
                                    <th>Total Price</th>
                                </tr>
                            </thead>
                            <tbody style="font-size:13px; color:#000000;">
                                <tr t-foreach="enumerate(o.invoice_line_ids, start=1)" t-as="l">
                                    <td><t t-esc="l[0]"/></td>
                                    <td style="text-align:left;">
                                        <span t-esc="l[1].product_id.default_code"/> - <span t-field="l[1].name"/>
                                    </td>
                                    <td><span t-field="l[1].quantity"/></td>
                                    <td><span t-field="l[1].product_uom_id.name"/></td>
                                    <td style="text-align:right;">
                                        <span t-field="l[1].price_unit" t-options='{"widget":"float","precision":2}'/>
                                    </td>
                                    <td style="text-align:right;">
                                        <t t-set="line_discount_amount" t-value="l[1].quantity * l[1].price_unit * (l[1].discount or 0.0) / 100.0"/>
                                        <span t-esc="line_discount_amount" t-options='{"widget":"float","precision":2}'/>
                                    </td>
                                    <td style="text-align:right;">
                                        <t t-set="line_subtotal" t-value="l[1].quantity * l[1].price_unit * (1 - (l[1].discount or 0.0)/100.0)"/>
                                        <span t-esc="line_subtotal" t-options='{"widget":"float","precision":2}'/>
                                    </td>
                                    <td>
                                        <t t-if="l[1].tax_ids"><span t-esc="', '.join(str(t.amount) + '%' for t in l[1].tax_ids)"/></t>
                                        <t t-else="">0%</t>
                                    </td>
                                    <td style="text-align:right;">
                                        <t t-set="line_vat_amount" t-value="line_subtotal * (sum(t.amount for t in l[1].tax_ids) / 100.0)"/>
                                        <span t-esc="line_vat_amount" t-options='{"widget":"float","precision":2}'/>
                                    </td>
                                    <td style="text-align:right;">
                                        <span t-esc="line_subtotal + line_vat_amount" t-options='{"widget":"float","precision":2}'/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Totals + QR + Seal -->
                        <table width="100%" style="margin-top:20px; font-size:13px;">
                            <tr>
                                <!-- Left Side -->
                                <td style="width:50%; vertical-align:top;">
                                    <table width="100%" style="border:1px solid #000; border-collapse:collapse; text-align:center;">
                                        <tr>
                                            <td style="padding:15px;">Delivered By<br/>سلمت بواسطة</td>
                                        </tr>
                                        <tr>
                                            <td style="padding:15px;">Received By<br/>المستلم</td>
                                        </tr>
                                        <tr>
                                            <td style="padding:15px;">Company Seal<br/><br/>
                                                <t t-if="o.company_id.logo">
                                                    <img t-att-src="image_data_uri(o.company_id.logo)" style="max-height:80px;"/>
                                                </t>
                                            </td>
                                        </tr>
                                        <tr>
                                <td width="15%"
                                    style="border:1px solid #ccc; text-align:center; vertical-align:middle;">
                                    <t t-if="o.qr_code_image">
                                        <img t-att-src="'data:image/png;base64,%s' % o.qr_code_image.decode('utf-8')"
                                             style="max-height:90px; max-width:90px; margin:5px;"/>
                                    </t>
                                    <div style="font-size:11px; color:#555;">Scan for Invoice</div>
                                </td>
                                        </tr>
                                    </table>
                                </td>

                                <!-- Right Side Totals -->
                                <td style="width:50%; vertical-align:top;">
                                    <table width="100%" style="border:1px solid #000; border-collapse:collapse;">
                                        <tr><td style="padding:6px;">Total Amount :</td>
                                            <td style="text-align:right; padding:6px;">
                                                <span t-set="subtotal" t-value="sum(l[1].quantity * l[1].price_unit for l in enumerate(o.invoice_line_ids, start=1))"/>
                                                <span t-esc="subtotal" t-options='{"widget":"float","precision":2}'/>
                                            </td>
                                        </tr>
                                        <tr><td style="padding:6px;">Discount :</td>
                                            <td style="text-align:right; padding:6px;">
                                                <span t-esc="o.discount_amount or 0.0" t-options='{"widget":"float","precision":2}'/>
                                            </td>
                                        </tr>
                                        <tr><td style="padding:6px;">Net Amount :</td>
                                            <td style="text-align:right; padding:6px;">
                                                <span t-set="net_amount" t-value="subtotal - (o.discount_amount or 0.0)"/>
                                                <span t-esc="net_amount" t-options='{"widget":"float","precision":2}'/>
                                            </td>
                                        </tr>
                                        <tr><td style="padding:6px;">VAT (15%) :</td>
                                            <td style="text-align:right; padding:6px;">
                                                <span t-set="vat_amount" t-value="sum(
                                                    (l[1].quantity * l[1].price_unit * (1 - (l[1].discount or 0.0)/100.0)) *
                                                    (sum(t.amount for t in l[1].tax_ids) / 100.0)
                                                    for l in enumerate(o.invoice_line_ids, start=1)
                                                )"/>
                                                <span t-esc="vat_amount" t-options='{"widget":"float","precision":2}'/>
                                            </td>
                                        </tr>
                                        <tr style="font-weight:bold; background:#f5f5f5;">
                                            <td style="padding:8px;">Grand Total :</td>
                                            <td style="text-align:right; padding:8px;">
                                                <span t-esc="net_amount + vat_amount" t-options='{"widget":"float","precision":2}'/>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>

                        <!-- Amount in Words -->
                        <div style="margin-top:10px; font-size:12px;">
                            <span t-esc="o.amount_total_in_words"/>
                        </div>
                    </t>
                </t>
            </t>
        </xpath>
    </template>
</odoo>