<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Dynamic Category Page Template -->
    <template id="category_page_template" name="Dynamic Category Page">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <!-- Hero Section -->
                <section class="s_parallax parallax s_parallax_is_fixed bg-black-50 o_half_screen_height o_colored_level"
                         data-scroll-background-ratio="1" data-snippet="s_parallax">
                    <span class="s_parallax_bg oe_img_bg o_bg_img_center"
                          style="background-image: url('/web/static/img/website_placeholder.jpg'); background-position: 50% 75%;"/>
                    <div class="o_we_bg_filter bg-black-50"/>
                    <div class="container h-100">
                        <div class="row h-100 align-items-center justify-content-center">
                            <div class="col-lg-8 text-center text-white">
                                <h1 class="display-3 font-weight-bold mb-3">Product Categories</h1>
                                <p class="lead">Explore our comprehensive range of industrial automation products</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Dynamic Category Section -->
                <section class="s_embed_code pt16 pb16 o_colored_level" data-snippet="s_embed_code">
                    <div class="container my-5 animate-on-scroll">
                        <h2 class="text-center mb-4">Explore Our Product Categories</h2>

                        <div class="category-slider-wrapper">
                            <button class="slider-arrow left" onclick="scrollCategories(-1)">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="15 18 9 12 15 6"/>
                                </svg>
                            </button>

                            <div class="category-tabs-container">
                                <div class="category-tabs" id="categoryTabs">
                                    <t t-foreach="categories" t-as="category">
                                        <button class="cat-btn"
                                                t-att-class="'active' if category_index == 0 else ''"
                                                t-att-onclick="'showCategory(\'' + category['slug'] + '\', this)'">
                                            <t t-esc="category['name']"/>
                                        </button>
                                    </t>
                                </div>
                            </div>

                            <button class="slider-arrow right" onclick="scrollCategories(1)">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="9 18 15 12 9 6"/>
                                </svg>
                            </button>
                        </div>

                        <div class="category-content">
                            <t t-foreach="categories" t-as="category">
                                <div t-att-id="category['slug']"
                                     class="cat-panel"
                                     t-att-class="'active' if category_index == 0 else ''">
                                    <div class="row align-items-center">
                                        <div class="col-md-6">
                                            <h3><t t-esc="category['name']"/></h3>
                                            <p><t t-esc="category['description']"/></p>
                                            <ul>
                                                <t t-foreach="category['features']" t-as="feature">
                                                    <li><t t-esc="feature"/></li>
                                                </t>
                                            </ul>
                                            <a t-att-href="category['url']" class="btn btn-primary mt-3">
                                                View Products (<t t-esc="category['product_count']"/>)
                                            </a>
                                        </div>
                                        <div class="col-md-6 text-center">
                                            <img t-att-src="category['image_url']"
                                                 class="img-fluid rounded"
                                                 t-att-alt="category['name']"
                                                 loading="lazy"
                                                 style="max-height: 400px; object-fit: contain;"/>
                                        </div>
                                    </div>
                                </div>
                            </t>
                        </div>
                    </div>
                </section>
            </div>
        </t>
    </template>

    <!-- Add CSS and JS to website assets -->
    <template id="category_assets" name="Category Assets" inherit_id="website.assets_frontend">
        <xpath expr="." position="inside">
            <style>
                .category-slider-wrapper {
                    position: relative;
                    display: flex;
                    align-items: center;
                    gap: 15px;
                    margin-bottom: 30px;
                    padding: 0 10px;
                }

                .slider-arrow {
                    background: #f1f3f5;
                    border: none;
                    width: 40px;
                    height: 40px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    flex-shrink: 0;
                    z-index: 10;
                }

                .slider-arrow:hover {
                    background: #007bff;
                    color: #fff;
                    transform: scale(1.1);
                }

                .category-tabs-container {
                    flex: 1;
                    overflow: hidden;
                    position: relative;
                }

                .category-tabs {
                    display: flex;
                    gap: 12px;
                    overflow-x: auto;
                    scroll-behavior: smooth;
                    scrollbar-width: none;
                    -ms-overflow-style: none;
                    padding: 10px 0;
                }

                .category-tabs::-webkit-scrollbar {
                    display: none;
                }

                .cat-btn {
                    background: #f1f3f5;
                    border: none;
                    padding: 12px 24px;
                    border-radius: 25px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    white-space: nowrap;
                    flex-shrink: 0;
                    font-size: 0.95rem;
                }

                .cat-btn:hover {
                    background: #007bff;
                    color: #fff;
                    transform: translateY(-2px);
                    box-shadow: 0 4px 12px rgba(0,123,255,0.3);
                }

                .cat-btn.active {
                    background: #007bff;
                    color: #fff;
                    box-shadow: 0 4px 12px rgba(0,123,255,0.3);
                }

                .category-content {
                    position: relative;
                    min-height: 400px;
                }

                .cat-panel {
                    position: absolute;
                    width: 100%;
                    opacity: 0;
                    visibility: hidden;
                    background: #f8f9fa;
                    padding: 40px;
                    border-radius: 20px;
                    box-shadow: 0 8px 24px rgba(0,0,0,0.06);
                    transition: opacity 0.5s ease, transform 0.5s ease, visibility 0.5s;
                    transform: translateY(20px);
                }

                .cat-panel.active {
                    position: relative;
                    opacity: 1;
                    visibility: visible;
                    transform: translateY(0);
                }

                .cat-panel h3 {
                    color: #007bff;
                    font-weight: 700;
                    margin-bottom: 16px;
                }

                .cat-panel p {
                    font-size: 1.05rem;
                    line-height: 1.7;
                    color: #555;
                    margin-bottom: 16px;
                }

                .cat-panel ul {
                    list-style: none;
                    padding: 0;
                }

                .cat-panel ul li {
                    padding: 8px 0;
                    padding-left: 28px;
                    position: relative;
                    color: #444;
                    font-size: 1rem;
                }

                .cat-panel ul li:before {
                    content: "âœ“";
                    position: absolute;
                    left: 0;
                    color: #007bff;
                    font-weight: bold;
                    font-size: 1.2rem;
                }

                .animate-on-scroll {
                    opacity: 0;
                    transform: translateY(40px);
                    animation: fadeInUp 0.8s ease-out forwards;
                }

                @keyframes fadeInUp {
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }

                @media (max-width: 768px) {
                    .cat-panel {
                        padding: 25px 20px;
                    }

                    .slider-arrow {
                        width: 35px;
                        height: 35px;
                    }

                    .cat-btn {
                        padding: 10px 18px;
                        font-size: 0.9rem;
                    }
                }
            </style>

            <script type="text/javascript">
                odoo.define('dynamic_category.category_slider', function (require) {
                    'use strict';

                    var publicWidget = require('web.public.widget');

                    publicWidget.registry.CategorySlider = publicWidget.Widget.extend({
                        selector: '.category-slider-wrapper',

                        start: function () {
                            this._super.apply(this, arguments);
                            this.autoScrollInterval = null;
                            this.categoryButtons = this.$('.cat-btn').toArray();
                            this.currentIndex = 0;

                            this._bindEvents();
                            this._startAutoScroll(2000);
                        },

                        _bindEvents: function () {
                            var self = this;

                            // Hover events
                            this.$el.on('mouseenter', function () {
                                self._stopAutoScroll();
                            });

                            this.$el.on('mouseleave', function () {
                                setTimeout(function () {
                                    self._startAutoScroll(2000);
                                }, 2000);
                            });
                        },

                        _startAutoScroll: function (delay) {
                            var self = this;
                            this._stopAutoScroll();
                            setTimeout(function () {
                                self.autoScrollInterval = setInterval(function () {
                                    self._autoAdvanceCategory();
                                }, 4000);
                            }, delay || 0);
                        },

                        _stopAutoScroll: function () {
                            if (this.autoScrollInterval) {
                                clearInterval(this.autoScrollInterval);
                                this.autoScrollInterval = null;
                            }
                        },

                        _autoAdvanceCategory: function () {
                            if (this.categoryButtons.length === 0) return;

                            this.currentIndex = (this.currentIndex + 1) % this.categoryButtons.length;
                            var nextButton = this.categoryButtons[this.currentIndex];

                            if (nextButton) {
                                $(nextButton).click();
                            }
                        },
                    });

                    // Global functions for onclick handlers
                    window.showCategory = function(id, button) {
                        // Stop auto-scroll
                        var widget = $('.category-slider-wrapper').data('publicWidget');
                        if (widget && widget._stopAutoScroll) {
                            widget._stopAutoScroll();
                        }

                        // Update panels
                        $('.cat-panel').removeClass('active');
                        $('#' + id).addClass('active');

                        // Update buttons
                        $('.cat-btn').removeClass('active');
                        $(button).addClass('active');

                        // Update current index
                        var categoryButtons = $('.cat-btn').toArray();
                        var currentIndex = categoryButtons.indexOf(button);
                        if (widget) {
                            widget.currentIndex = currentIndex;
                        }

                        // Center the clicked button
                        var container = $('.category-tabs')[0];
                        var buttonRect = button.getBoundingClientRect();
                        var containerRect = container.getBoundingClientRect();
                        var scrollLeft = button.offsetLeft - (containerRect.width / 2) + (buttonRect.width / 2);
                        $(container).animate({ scrollLeft: scrollLeft }, 300);

                        // Restart auto-scroll after 5 seconds
                        if (widget && widget._startAutoScroll) {
                            setTimeout(function () {
                                widget._startAutoScroll(0);
                            }, 5000);
                        }
                    };

                    window.scrollCategories = function(direction) {
                        var widget = $('.category-slider-wrapper').data('publicWidget');
                        if (widget && widget._stopAutoScroll) {
                            widget._stopAutoScroll();
                        }

                        var container = $('.category-tabs')[0];
                        var scrollAmount = 200;
                        $(container).animate({ scrollLeft: container.scrollLeft + (direction * scrollAmount) }, 300);

                        // Restart auto-scroll
                        if (widget && widget._startAutoScroll) {
                            setTimeout(function () {
                                widget._startAutoScroll(0);
                            }, 5000);
                        }
                    };
                });
            </script>
        </xpath>
    </template>

    <!-- Add menu item (optional) -->
    <record id="menu_category_page" model="website.menu">
        <field name="name">Categories</field>
        <field name="url">/shop/categories</field>
        <field name="parent_id" ref="website.main_menu"/>
        <field name="sequence" type="int">50</field>
    </record>
</odoo>