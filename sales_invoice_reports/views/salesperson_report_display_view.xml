<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- QWeb Template for Salesperson Report Display -->
        <template id="salesperson_report_display_template">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <div class="container">
                        <div class="page">
                            <style>
                                .report-header {
                                    text-align: left;
                                    margin-bottom: 20px;
                                    border-bottom: 2px solid #333;
                                    padding-bottom: 10px;
                                }
                                .report-title {
                                    font-size: 18px;
                                    font-weight: bold;
                                    margin-bottom: 5px;
                                }
                                .report-date {
                                    font-size: 12px;
                                    color: #666;
                                }
                                .salesperson-section {
                                    margin-top: 20px;
                                    page-break-inside: avoid;
                                }
                                .salesperson-header {
                                    background-color: #e0e0e0;
                                    padding: 8px;
                                    font-weight: bold;
                                    margin-bottom: 10px;
                                }
                                .invoice-group {
                                    margin-bottom: 15px;
                                    border: 1px solid #ddd;
                                }
                                .invoice-header {
                                    background-color: #f5f5f5;
                                    padding: 8px;
                                    font-weight: bold;
                                    display: grid;
                                    grid-template-columns: 100px 120px 1fr 120px;
                                    gap: 10px;
                                }
                                .line-items-header {
                                    background-color: #e8e8e8;
                                    padding: 5px 8px;
                                    display: grid;
                                    grid-template-columns: 50px 100px 200px 80px 60px 80px 60px 60px 80px 100px;
                                    gap: 5px;
                                    font-weight: bold;
                                    font-size: 12px;
                                    border-top: 1px solid #ccc;
                                    border-bottom: 1px solid #ccc;
                                }
                                .line-item {
                                    padding: 5px 8px;
                                    display: grid;
                                    grid-template-columns: 50px 100px 200px 80px 60px 80px 60px 60px 80px 100px;
                                    gap: 5px;
                                    font-size: 12px;
                                    border-bottom: 1px solid #eee;
                                }
                                .line-item:hover {
                                    background-color: #f9f9f9;
                                }
                                .invoice-total {
                                    background-color: #f0f0f0;
                                    padding: 8px;
                                    text-align: right;
                                    font-weight: bold;
                                    border-top: 2px solid #999;
                                }
                                .salesperson-total {
                                    background-color: #d0d0d0;
                                    padding: 10px;
                                    text-align: right;
                                    font-weight: bold;
                                    font-size: 14px;
                                    margin-top: 10px;
                                    border-top: 2px solid #666;
                                }
                                .text-right {
                                    text-align: right;
                                }
                            </style>

                            <!-- Report Header -->
                            <div class="report-header">
                                <div class="report-title">
                                    <t t-esc="title or 'Sales Invoice Report'"></t>
                                </div>
                                <div class="report-date" t-if="date_from and date_to">
                                    Between <t t-esc="date_from"></t> To <t t-esc="date_to"></t>
                                </div>
                            </div>

                            <!-- Salesperson Sections -->
                            <t t-foreach="salesperson_data" t-as="sp_data">
                                <div class="salesperson-section">
                                    <div class="salesperson-header">
                                        Sales Man: <t t-esc="sp_data['salesperson_name']"></t>
                                    </div>

                                    <!-- Invoices -->
                                    <t t-foreach="sp_data['invoices']" t-as="invoice">
                                        <div class="invoice-group">
                                            <!-- Invoice Header -->
                                            <div class="invoice-header">
                                                <div><strong>Date</strong></div>
                                                <div><strong>Inv No</strong></div>
                                                <div><strong>Customer Name</strong></div>
                                                <div><strong>Sales Ac</strong></div>
                                            </div>
                                            <div class="invoice-header" style="font-weight: normal; background-color: #fafafa;">
                                                <div><t t-esc="invoice['date']"></t></div>
                                                <div><t t-esc="invoice['number']"></t></div>
                                                <div><t t-esc="invoice['customer']"></t></div>
                                                <div><t t-esc="invoice['account']"></t></div>
                                            </div>

                                            <!-- Line Items Header -->
                                            <div class="line-items-header">
                                                <div>Slno</div>
                                                <div>Code</div>
                                                <div>Name</div>
                                                <div>Qty</div>
                                                <div>Unit</div>
                                                <div>Rate</div>
                                                <div>Free</div>
                                                <div>Unit</div>
                                                <div>Discount</div>
                                                <div>Net Total</div>
                                            </div>

                                            <!-- Line Items -->
                                            <t t-foreach="invoice['lines']" t-as="line">
                                                <div class="line-item">
                                                    <div><t t-esc="line['sequence']"></t></div>
                                                    <div><t t-esc="line['code']"></t></div>
                                                    <div><t t-esc="line['name']"></t></div>
                                                    <div class="text-right"><t t-esc="'%.2f' % line['quantity']"></t></div>
                                                    <div><t t-esc="line['uom']"></t></div>
                                                    <div class="text-right"><t t-esc="'%.2f' % line['price_unit']"></t></div>
                                                    <div class="text-right">0.00</div>
                                                    <div><t t-esc="line['uom']"></t></div>
                                                    <div class="text-right"><t t-esc="'%.2f' % line['discount']"></t></div>
                                                    <div class="text-right"><t t-esc="'%.2f' % line['subtotal']"></t></div>
                                                </div>
                                            </t>

                                            <!-- Invoice Total -->
                                            <div class="invoice-total">
                                                Total: <t t-esc="'%.2f' % invoice['total']"></t>
                                            </div>
                                        </div>
                                    </t>

                                    <!-- Salesperson Total -->
                                    <div class="salesperson-total">
                                        Total for <t t-esc="sp_data['salesperson_name']"></t>: <t t-esc="'%.2f' % sp_data['total']"></t>
                                    </div>
                                </div>
                            </t>
                        </div>
                    </div>
                </t>
            </t>
        </template>

        <!-- Action to display report in Odoo tab -->
        <record id="action_salesperson_report_display" model="ir.actions.report">
            <field name="name">Sales Invoice Report</field>
            <field name="model">report.by.salesperson.wizard</field>
            <field name="report_type">qweb-html</field>
            <field name="report_name">sales_invoice_reports.salesperson_report_display_template</field>
            <field name="report_file">sales_invoice_reports.salesperson_report_display_template</field>
            <field name="binding_model_id" ref="model_report_by_salesperson_wizard"/>
            <field name="binding_type">report</field>
        </record>
    </data>
</odoo>