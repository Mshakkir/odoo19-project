<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Inherit the original payment receipt report -->
    <template id="report_payment_receipt_document_custom" inherit_id="account.report_payment_receipt_document">

        <!-- Replace the entire external_layout with custom layout -->
        <xpath expr="//t[@t-call='web.external_layout']" position="replace">
            <t t-set="o" t-value="o.with_context(lang=lang)"/>
            <t t-set="values" t-value="o._get_payment_receipt_report_values()"/>

            <head>
                        <meta charset="UTF-8"/>
                        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
                        <style type="text/css">
                            @import url('https://fonts.googleapis.com/css2?family=Noto+Naskh+Arabic:wght@400;700&amp;display=swap');

                            @page {
                            margin: 20mm;
                            }

                            body {
                            font-family: 'DejaVu Sans', Arial, sans-serif;
                            }

                            @media screen {
                            .header, .footer {
                            display: none !important;
                            }
                            }

                            .ar {
                            font-family: 'Noto Naskh Arabic', 'DejaVu Sans', Arial, sans-serif !important;
                            direction: rtl;
                            unicode-bidi: bidi-override;
                            font-weight: 700;
                            display: inline-block;
                            }

                            table {
                            width: 100%;
                            border-collapse: collapse;
                            }

                            * {
                            box-sizing: border-box;
                            }
                        </style>
                    </head>

                    <div class="page">
                        <div class="header"
                             style="border:2px solid white; border-radius: 6px; background: white; margin-bottom: 15px;">
                            <table style="width: 100%; border-collapse: collapse;border:none; border: 2px solid white;">
                                <tr>
                                    <td style="width: 50%; padding: 10px 20px; text-align: left; vertical-align: middle; border:none;padding-left:0px;">
                                        <div style="color: #8B1538; font-size: 16px; font-weight: bold; text-transform: uppercase;">
                                            SAMEER SHARAF AL OTAIBI TRADING COMPANY
                                        </div>
                                    </td>
                                    <td style="width: 50%; padding: 10px 20px; text-align: right; vertical-align: middle; border:none;padding-right:0px;">
                                        <div style="color: #8B1538; font-size: 17px; font-weight: 900; direction: rtl; font-family: 'Tajawal', sans-serif;"
                                             class="ar">
                                            شركة سمير شرف العتيبي التجارية
                                        </div>
                                    </td>
                                </tr>
                            </table>

                            <table style="width: 100%; border-collapse: collapse;">
                                <tr>
                                    <td style="width: 33%; text-align: left; font-size: 16px; color: #333; vertical-align: top; border-top: 2px solid white;border-right: 0px solid white; border-bottom: 1px solid white;border-left: 1px solid white;padding-top:0px;padding-left:0px;">
                                        <div style="line-height: 1.3; font-weight: 500;padding-left:0px;padding-top:0px;margin-top:0px;">
                                            C.R. 4030216154
                                            <br/>
                                            VAT Regd: 311299944700003
                                        </div>
                                    </td>
                                    <td style="width: 34%; text-align: center; vertical-align: top; padding: 5px 10px; border-top: 2px solid white;border-right: 0px solid white; border-bottom: 1px solid white;border-left: 1px solid white;">
                                        <t t-if="o.company_id.logo">
                                            <img t-att-src="image_data_uri(o.company_id.logo)"
                                                 style="max-height: 140px; max-width: 100%; object-fit: contain; display: block; margin: -23px auto;padding-top:8px;padding-top:5px;"/>
                                        </t>
                                    </td>
                                    <td style="width: 33%; text-align: right; font-size: 15px; color: #333; vertical-align: top; direction: rtl; padding: 0px 10px 6px 10px; border-top: 1px solid white;border-right: 0px solid white; border-bottom: 1px solid white; border-left: 1px solid white;">
                                        <div style="line-height: 1.3; font-family: 'Tajawal', sans-serif; font-weight:900; padding-right:0px; margin-top:0px; text-align: right; direction: rtl;"
                                             class="ar">
                                            س.ت: ٤٠٣٠٢١٦١٥٤
                                            <br/>
                                            الرقم الضريبي: ٣١١٢٩٩٩٤٤٧٠٠٠٠٣
                                            <br/>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>




                    <!-- ===== TITLE - Different for Customer vs Vendor ===== -->
                    <div style="text-align: center; margin-top: 5px; margin-bottom: 5px;">
                        <h3 style="margin: 0; padding: 5px 0; font-size: 20px; font-weight: bold;">
                            <t t-if="o.payment_type == 'inbound'">
                                Receipt Voucher
                            </t>
                            <t t-if="o.payment_type == 'outbound'">
                                Payment Voucher
                            </t>
                        </h3>
                    </div>

                </div>

                <!-- ===== CONTENT BOX ===== -->
                <div class="content-box">

                    <!-- Top Row: Voucher Number and Date -->
                    <table style="width: 100%; margin-bottom: 15px;">
                        <tr>
                            <td style="width: 50%;">
                                Voucher :
                                <span t-field="o.name"/>
                            </td>
                            <td style="width: 50%; text-align: right;">
                                Date :
                                <span t-field="o.date"/>
                            </td>
                        </tr>
                    </table>

                    <!-- Received From / Paid To -->
                    <div style="margin-bottom: 10px;">
                        <t t-if="o.payment_type == 'inbound'">
                            Received From :<span t-field="o.partner_id.name"/>.
                        </t>
                        <t t-if="o.payment_type == 'outbound'">
                            Paid To :<span t-field="o.partner_id.name"/>.
                        </t>
                    </div>

                    <!-- Amount -->
                    <div style="margin-bottom: 10px;">
                        Amount :
                        <t t-esc="'{:,.2f}'.format(o.amount)"/>
                        <t t-esc="o.currency_id.name"/>
                    </div>

                    <!-- Amount in Words -->
                    <div style="margin-bottom: 15px;">
                        <t t-set="amount_words" t-value="o.currency_id.amount_to_text(o.amount)"/>
                        <span t-esc="amount_words"/>
                        only.
                    </div>

                    <!-- ===== PAYMENT DETAILS TABLE - ONLY FOR CUSTOMER RECEIPTS ===== -->
                    <t t-if="o.payment_type == 'inbound'">
                        <div style="margin-top:20px; margin-bottom:20px;">
                            <h4 style="margin-bottom:10px;">
                                <strong>Payment Details</strong>
                            </h4>

                            <t t-set="invoices" t-value="o.reconciled_invoice_ids or o.reconciled_bill_ids"/>

                            <table style="width:100%; border-collapse: collapse; font-size:14px; border: 1px solid #000;">
                                <thead style="background:#FFFFFF;">
                                    <tr>
                                        <th style="padding:8px; border:1px solid #000;">INVOICE DATE</th>
                                        <th style="padding:8px; border:1px solid #000;">INVOICE NUMBER</th>
                                        <th style="padding:8px; border:1px solid #000;">REFERENCE</th>
                                        <th style="padding:8px; border:1px solid #000; text-align:right;">AMOUNT</th>
                                    </tr>
                                </thead>

                                <tbody>
                                    <t t-if="invoices">
                                        <t t-foreach="invoices" t-as="inv">
                                            <!-- Only show if it's an invoice/bill (not journal entry) -->
                                            <t t-if="inv.move_type != 'entry'">

                                                <!-- INVOICE/BILL HEADER ROW -->
                                                <tr style="background:#FFFFFF;">
                                                    <td style="padding:8px; border:1px solid #000;">
                                                        <span t-field="inv.invoice_date"/>
                                                    </td>
                                                    <td style="padding:8px; border:1px solid #000;">
                                                        <strong>
                                                            <span t-field="inv.name"/>
                                                        </strong>
                                                    </td>
                                                    <td style="padding:8px; border:1px solid #000;">
                                                        <span t-field="inv.ref"/>
                                                    </td>
                                                    <td style="padding:8px; border:1px solid #000; text-align:right;">
                                                        <strong>
                                                            <t t-esc="'{:,.2f}'.format(inv.amount_total)"/>
                                                            <t t-esc="inv.currency_id.name"/>
                                                        </strong>
                                                    </td>
                                                </tr>

                                                <!-- PAYMENT ROWS (reconciled lines) -->
                                                <tr t-foreach="inv._get_reconciled_invoices_partials()[0]" t-as="par">
                                                    <t t-set="payment" t-value="par[2]"/>

                                                    <td style="padding:8px; border:1px solid #000; padding-left:20px;">
                                                        <span t-field="payment.move_id.date"/>
                                                    </td>

                                                    <td style="padding:8px; border:1px solid #000; padding-left:20px;">
                                                        <span t-field="payment.move_id.name"/>
                                                    </td>

                                                    <td style="padding:8px; border:1px solid #000;">
                                                        <span t-field="payment.payment_id.memo"/>
                                                    </td>

                                                    <td style="padding:8px; border:1px solid #000; text-align:right;">
                                                        <t t-set="amountInvoice" t-value="-par[1]"/>
                                                        <t t-esc="'{:,.2f}'.format(amountInvoice)"/>
                                                        <t t-esc="inv.currency_id.name"/>
                                                    </td>
                                                </tr>

                                                <!-- DUE AMOUNT ROW -->
                                                <tr>
                                                    <td style="padding:8px; border:1px solid #000;"></td>
                                                    <td style="padding:8px; border:1px solid #000;">
                                                        <strong>Due Amount for
                                                            <span t-field="inv.name"/>
                                                        </strong>
                                                    </td>
                                                    <td style="padding:8px; border:1px solid #000;"></td>
                                                    <td style="padding:8px; border:1px solid #000; text-align:right;">
                                                        <strong>
                                                            <t t-esc="'{:,.2f}'.format(inv.amount_residual)"/>
                                                            <t t-esc="inv.currency_id.name"/>
                                                        </strong>
                                                    </td>
                                                </tr>
                                            </t>
                                        </t>
                                    </t>

                                    <!-- If no invoices/bills found -->
                                    <t t-if="not invoices">
                                        <tr>
                                            <td colspan="4"
                                                style="padding:20px; border:1px solid #000; text-align:center; color:#666;">
                                                No invoice reconciliation data available for this payment.
                                            </td>
                                        </tr>
                                    </t>

                                </tbody>
                            </table>
                        </div>
                    </t>

                    <!-- Remark Section -->
                    <div style="margin-bottom: 20px; margin-top: 20px;">
                        Remark :
                        <t t-if="'memo_new' in o._fields and o.memo_new">
                            <span t-field="o.memo_new"/>
                        </t>
                        <t t-elif="o.memo">
                            <span t-field="o.memo"/>
                        </t>
                    </div>

                    <!-- Signature Section -->
                    <table style="width: 100%; margin-top: 25px;">
                        <tr>
                            <td style="width: 33%; vertical-align: bottom; padding-bottom: 10px;">
                                <div style="padding-bottom: 40px; margin-bottom: 5px;"></div>
                                Checked By :
                            </td>
                            <td style="width: 34%; vertical-align: bottom; padding-bottom: 10px; text-align: center;">
                                <div style="padding-bottom: 40px; margin-bottom: 5px;"></div>
                                Verified By :
                            </td>
                            <td style="width: 33%; vertical-align: bottom; padding-bottom: 10px; text-align: right;">
                                <div style="padding-bottom: 40px; margin-bottom: 5px;"></div>
                                Authorised Signatory :
                            </td>
                        </tr>
                    </table>

                </div>

                <!-- ===== FOOTER BOX WITH BRANCH DETAILS ===== -->
                <div class="footer" style="margin-top: 30px; page-break-inside: avoid;">
                    <table width="100%" style="border-collapse: collapse; margin-bottom:5px; font-size:10px;">
                        <tr>
                            <td class="ar"
                                style="padding:2px; text-align:left;width:50%; vertical-align: top; position: relative;border-right:1px solid #000000;">
                                <!-- Bank Logo - Top Right of left column -->
                                <div style="position: absolute; top: 5px; right: 50px;">
                                    <img src="/my_invoice_custom/static/src/img/Alrajhi logo.png"
                                         alt="Alrajhi Bank"
                                         style="width: 100px; height: 60px;"/>
                                </div>
                                <!-- Bank Details with padding to avoid overlap -->
                                <div style="padding-top: 5px;">
                                    Sameer Sharaf Al Otaibi Trading Company
                                    <br/>
                                    شركة سمير شرف العتيبي التجارية
                                    <br/>
                                    Alrajhi Bank – مصرف الراجحي
                                    <br/>
                                    Account Number:رقم الحساب:123000010006080143917
                                    <br/>
                                    IBAN: SA7880000123608010143917 :رقم الحساب الدولي
                                </div>
                            </td>
                            <td class="ar"
                                style="padding:2px; text-align:right;width:50%; vertical-align: top; position: relative;">
                                <!-- Bank Logo - Bottom Left of right column -->
                                <div style="position: absolute; bottom: 0; left: 35px;">
                                    <img src="/my_invoice_custom/static/src/img/Snb logo.png"
                                         alt="Saudi National Bank"
                                         style="width: 100px; height: auto;"/>
                                </div>
                                <!-- Bank Details -->
                                <div style="padding-top: 5px;">
                                    Sameer Sharaf Alateebi Company Commercial
                                    <br/>
                                    شركة سمير شرف العتيبي التجارية
                                    <br/>
                                    SNB - Saudi National Bank/البنك الأهلي السعودي
                                    <br/>
                                    Account Number at SNB: 13200000678707 :رقم الحساب
                                    <br/>
                                    (IBAN): SA2110000013200000678707 :رقم الحساب الدولي
                                </div>
                            </td>
                        </tr>
                    </table>
                    <table width="100%" style="border-collapse: collapse; margin-bottom:5px; font-size:10px;">
                        <tr>
                            <td style="width:33%; padding:4px;border-right: 1px solid black; text-align: right;">
                                حي السوق . شارع/ سعد الكندي . رقم المبنى ٨٥١٥
                                <br/>
                                الدمام ٣٢٢٤٢ - ٤٥٢٥ - المملكة العربية السعودية
                                <br/>
                                هاتف : ٠٥٣٥٥٠٨١٠٠٨
                                <br/>
                                <span style="direction: ltr; display: inline-block;">
                                    District Al Souq, Street Sa'ad Al Kandi, Building No. 8515
                                    <br/>
                                    Dammam 4525-32242 - Saudi Arabia
                                    <br/>
                                    Tel: 05355081008
                                </span>
                                <br/>
                                Email: ssaoe dammam@gmail.com, opmdmm@ssaoco.com
                            </td>

                            <td style="width:33%; padding:4px; text-align: right;">
                                مركز الأنوار . رقم صحل ١٢ . شارع البلدية
                                <br/>
                                جدة ٢٣٣٣٤ - المملكة العربية السعودية
                                <br/>
                                هاتف : ٠٥٣٦٠٨١٨٠١
                                <br/>
                                <span style="direction: ltr; display: inline-block;">
                                    Al Anwar Centre, Showroom No. 12,
                                    <br/>
                                    Baladiya Street, Jeddah 23334 - Saudi Arabia
                                    <br/>
                                    Tel: 0536122833
                                </span>
                                <br/>
                                Email: ssaoe.jeddah@gmail.com
                            </td>

                            <td style="width:33%; padding:4px;border-left: 1px solid black; text-align: right;">
                                الفيحاء ٧٦٥٥
                                <br/>
                                جدة ٢٢٢٤٤-٣١٠٨ - المملكة العربية السعودية
                                <br/>
                                هاتف : ٠١٢٢٣٤٥٥٢٣
                                <br/>
                                <span style="direction: ltr; display: inline-block;">
                                    Chamber Membership No: 160264 - Al Fayha 7655
                                    <br/>
                                    Jeddah 22244-3108 - Saudi Arabia
                                    <br/>
                                    Tel: 0122345523
                                </span>
                                <br/>
                                Email: ssaoe.jeddah@gmail.com
                            </td>
                        </tr>
                    </table>
                </div>
        </xpath>

    </template>

</odoo>
