<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Quick Invoice Form View -->
        <record id="view_order_form_quick_invoice" model="ir.ui.view">
            <field name="name">sale.order.form.quick.invoice</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">

                <!-- Add Quick Invoice Buttons in Header -->
                <xpath expr="//header" position="inside">
                    <button name="action_quick_invoice_draft"
                            string="üìÑ Create Invoice (Draft)"
                            type="object"
                            class="btn-primary"
                            attrs="{'invisible': ['|', ('quick_invoice_mode', '=', False), ('invoice_status', '=', 'invoiced')]}"
                            groups="quick_invoice_pro.group_quick_invoice_user"/>

                    <button name="action_quick_invoice_posted"
                            string="‚úÖ Create Invoice &amp; Pay"
                            type="object"
                            class="btn-success"
                            attrs="{'invisible': ['|', ('quick_invoice_mode', '=', False), ('invoice_status', '=', 'invoiced')]}"
                            groups="quick_invoice_pro.group_quick_invoice_user"/>

                    <button name="action_quick_return"
                            string="‚Ü©Ô∏è Quick Return"
                            type="object"
                            class="btn-warning"
                            attrs="{'invisible': ['|', ('quick_invoice_mode', '=', False), ('invoice_count', '=', 0)]}"
                            groups="quick_invoice_pro.group_quick_invoice_user"/>
                </xpath>

                <!-- Add Stock Warning Banner -->
                <xpath expr="//sheet" position="before">
                    <div class="alert alert-warning" role="alert"
                         attrs="{'invisible': ['|', ('quick_invoice_mode', '=', False), ('stock_availability_status', '=', 'available')]}">
                        <strong>‚ö†Ô∏è Stock Warning</strong>
                        <field name="stock_warning_message" readonly="1"/>
                    </div>

                    <div class="alert alert-info" role="alert"
                         attrs="{'invisible': [('requires_approval', '=', False)]}">
                        <strong>üîí Manager Approval Required</strong>
                        <p>This order exceeds the approval threshold and requires manager approval.</p>
                    </div>
                </xpath>

                <!-- Add Stock Info to Order Lines -->
                <xpath expr="//field[@name='order_line']/tree/field[@name='product_uom_qty']" position="after">
                    <field name="available_qty"
                           string="Available"
                           attrs="{'column_invisible': [('parent.quick_invoice_mode', '=', False)]}"/>
                </xpath>

                <!-- Add Quick Invoice Fields -->
                <xpath expr="//field[@name='partner_id']" position="after">
                    <field name="quick_invoice_mode" invisible="1"/>
                    <field name="requires_approval" invisible="1"/>
                    <field name="stock_availability_status" invisible="1"/>
                </xpath>

            </field>
        </record>

        <!-- Quick Invoice Tree View -->
        <record id="view_order_tree_quick_invoice" model="ir.ui.view">
            <field name="name">sale.order.tree.quick.invoice</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_quotation_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='amount_total']" position="after">
                    <field name="stock_availability_status"
                           widget="badge"
                           decoration-success="stock_availability_status == 'available'"
                           decoration-warning="stock_availability_status == 'partial'"
                           decoration-danger="stock_availability_status == 'none'"
                           optional="show"/>
                    <field name="requires_approval"
                           widget="boolean_toggle"
                           optional="show"/>
                </xpath>
            </field>
        </record>

    </data>
</odoo>