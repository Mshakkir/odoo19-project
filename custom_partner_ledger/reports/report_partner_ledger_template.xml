<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Inherit and customize the partner ledger template -->
    <template id="report_partnerledger_custom"
              inherit_id="accounting_pdf_reports.report_partnerledger">

        <xpath expr="//t[@t-call='web.html_container']" position="replace">
            <t t-call="web.html_container">
                <t t-call="web.basic_layout">

                    <style>
                        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700;900&amp;display=swap');

                        .ar {
                            font-family: 'Noto Sans Arabic', Arial, sans-serif !important;
                        }

                        .header {
                            page-break-inside: avoid;
                        }

                        .report-params {
                            page-break-inside: avoid !important;
                            page-break-after: avoid !important;
                        }

                        /* Force table header to repeat on every page */
                        .ledger-table thead {
                            display: table-header-group !important;
                        }

                        .ledger-table tbody {
                            display: table-row-group !important;
                        }

                        /* Prevent rows from breaking across pages */
                        .ledger-table tbody tr {
                            page-break-inside: avoid !important;
                            page-break-after: auto;
                        }

                        /* Reduce spacing for better fit */
                        @media print {
                            .page {
                                padding-top: 10px !important;
                            }

                            table {
                                border-collapse: collapse !important;
                            }

                            .header {
                                margin-bottom: 15px !important;
                            }

                            .report-params {
                                margin-bottom: 10px !important;
                            }
                        }
                    </style>

                    <!-- Custom Header -->
                    <div class="header" style="border:2px solid white; border-radius: 6px; background: white; margin-bottom: 25px; padding: 15px 0;">
                        <table style="width: 100%; border-collapse: collapse; border:none; margin-bottom: 0px;">
                            <tr style="border:2px solid white;">
                                <td style="width: 50%; padding: 10px 0px; text-align: left; vertical-align: middle; border: none;padding-bottom:0px;">
                                    <div style="color: #8B1538; font-size: 14px; font-weight: bold; text-transform: uppercase;">
                                        SAMEER SHARAF AL OTAIBI TRADING COMPANY
                                    </div>
                                </td>
                                <td style="width: 50%; padding: 10px 0px; text-align: right; vertical-align: middle; border: none;">
                                    <div style="color: #8B1538; font-size: 16px; font-weight: 900; direction: rtl;padding-bottom:0px;" class="ar">
                                        شركة سمير شرف العتيبي التجارية
                                    </div>
                                </td>
                            </tr>
                        </table>

                        <table style="width: 100%; border-collapse: collapse;">
                            <tr style="border:2px solid white;">
                                <td style="width: 33%; text-align: left; font-size: 14px; color: #333; vertical-align: middle;
                                padding: 0px 0px 10px 0px; border-top: 1px solid #ddd; border-bottom: 2px solid #8B1538;">
                                    <div style="line-height: 1.6; font-weight: 500; margin-top: 10px;">
                                        C.R. 4030216154<br/>
                                        VAT Regd: 311299944700003
                                    </div>
                                </td>

                                <td style="width: 34%; text-align: center; vertical-align: middle; padding: 5px 10px;
                                border-top: 1px solid #ddd; border-bottom: 2px solid #8B1538;">
                                    <img t-att-src="'/custom_partner_ledger/static/src/img/faakart_logo.png'"
                                         style="max-height: 90px; max-width: 100%; object-fit: contain;"
                                         alt="Company Logo"/>
                                </td>

                                <td style="width: 33%; text-align: right; font-size: 14px; color: #333; vertical-align: middle;
                                direction: rtl; padding: 0px 0px 10px 0px; border-top: 1px solid #ddd; border-bottom: 2px solid #8B1538;">
                                    <div style="line-height: 1.6; font-weight: 900; text-align: right; direction: rtl; margin-top: 10px;" class="ar">
                                        س.ت: ٤٠٣٠٢١٦١٥٤<br/>
                                        الرقم الضريبي: ٣١١٢٩٩٩٤٤٧٠٠٠٠٣
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <!-- Report Title -->
                    <div class="row" style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 3px solid white; margin-top: 5px;">
                        <div class="col-8">
                            <h5 style="margin: 0; color: black; font-weight: bold;" t-esc="partner_type_info['report_title']"/>
                        </div>
                        <div class="col-4 text-end">
                            <p style="margin: 0;">
                                <strong>Report Date:</strong><br/>
                                <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/>
                            </p>
                        </div>
                    </div>

                    <!-- Partner Details Block (below title) -->
                    <t t-foreach="docs" t-as="o">
                        <div style="margin-bottom: 8px; padding: 8px 12px; background-color: #f8f9fa; border-left: 3px solid #8B1538;">
                            <div>
                                <strong t-esc="get_partner_label(data, o)"/>:
                                <strong t-esc="o.name"/>
                            </div>
                            <div t-if="o.vat" style="color: #555; font-size: 12px;">
                                VAT: <t t-esc="o.vat"/>
                            </div>
                            <div t-if="o.street" style="color: #555; font-size: 12px;">
                                <t t-esc="o.street"/>
                            </div>
                            <div t-if="o.street2" style="color: #555; font-size: 12px;">
                                <t t-esc="o.street2"/>
                            </div>
                            <div t-if="o.city or o.zip" style="color: #555; font-size: 12px;">
                                <t t-if="o.city"><t t-esc="o.city"/></t>
                                <t t-if="o.zip"> <t t-esc="o.zip"/></t>
                            </div>
                            <div t-if="o.state_id or o.country_id" style="color: #555; font-size: 12px;">
                                <t t-if="o.state_id"><t t-esc="o.state_id.name"/><t t-if="o.country_id">, </t></t>
                                <t t-if="o.country_id"><t t-esc="o.country_id.name"/></t>
                            </div>
                            <div t-if="o.phone" style="color: #555; font-size: 12px;">
                                Tel: <t t-esc="o.phone"/>
                            </div>
                            <div t-if="o.email" style="color: #555; font-size: 12px;">
                                Email: <t t-esc="o.email"/>
                            </div>
                        </div>
                    </t>

                    <!-- Report Parameters -->
                    <div class="report-params">
                        <div class="row" style="margin-bottom: 8px;">

                            <div class="col-4">
                                <strong>Target Moves:</strong>
                                <p style="margin: 3px 0;">
                                    <span t-if="data['form']['target_move'] == 'all'">All Entries</span>
                                    <span t-if="data['form']['target_move'] == 'posted'">All Posted Entries</span>
                                </p>
                            </div>
                            <div class="col-4">
                                <!-- Display dynamic label based on account type -->
                                <strong t-esc="partner_type_info['display_label']"/>:
                                <p t-esc="partner_type_info['count']" style="margin: 3px 0;"/>
                            </div>

                            <div class="col-4">
                                <strong>Reconciled Items:</strong>
                                <p style="margin: 3px 0;">
                                    <span t-if="data['form']['reconciled']">Included</span>
                                    <span t-else="">Excluded</span>
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Partner Ledger Table -->
                    <table class="table table-sm table-bordered ledger-table"
                           style="margin-bottom: 15px; width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background-color: #A3AABE; color: black;">
                                <th style="padding: 6px; text-align: left; border: 1px solid #ddd;">Date</th>
                                <th style="padding: 6px; text-align: left; border: 1px solid #ddd;">Due Date</th>
                                <th style="padding: 6px; text-align: left; border: 1px solid #ddd;">JRNL</th>
                                <th style="padding: 6px; text-align: left; border: 1px solid #ddd;">Account</th>
                                <th style="padding: 6px; text-align: left; border: 1px solid #ddd;">Ref</th>
                                <th style="padding: 6px; text-align: left; border: 1px solid #ddd;">PO Number</th>
                                <th style="padding: 6px; text-align: right; border: 1px solid #ddd;">Debit</th>
                                <th style="padding: 6px; text-align: right; border: 1px solid #ddd;">Credit</th>
                                <th style="padding: 6px; text-align: right; border: 1px solid #ddd;">Balance</th>
                                <th t-if="data['form']['amount_currency']"
                                    style="padding: 6px; text-align: right; border: 1px solid #ddd;">Currency</th>
                            </tr>
                        </thead>
                        <t t-foreach="docs" t-as="o">
                            <tbody>
                                <!-- Partner Header Row with dynamic label -->
                                <tr style="background-color: #f8f9fa; border-top: 2px solid #8B1538;">
                                    <td colspan="6" style="padding: 10px; border: 1px solid #ddd;">
                                        <!-- Dynamic label: Customer or Vendor -->
                                        <strong t-esc="get_partner_label(data, o)"/>:
                                        <span t-esc="o.ref" t-if="o.ref"/>
                                        <span t-if="o.ref"> - </span>
                                        <strong t-esc="o.name"/>
                                        <span t-if="o.vat" class="text-muted"> (VAT: <t t-esc="o.vat"/>)</span>
                                    </td>
                                    <td class="text-end" style="padding: 10px; border: 1px solid #ddd;">
                                        <strong t-esc="sum_partner(data, o, 'debit')"
                                                t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                    </td>
                                    <td class="text-end" style="padding: 10px; border: 1px solid #ddd;">
                                        <strong t-esc="sum_partner(data, o, 'credit')"
                                                t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                    </td>
                                    <td class="text-end" style="padding: 10px; border: 1px solid #ddd;">
                                        <strong t-esc="sum_partner(data, o, 'debit - credit')"
                                                t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                    </td>
                                    <td t-if="data['form']['amount_currency']" style="padding: 10px; border: 1px solid #ddd;"/>
                                </tr>

                                <!-- Partner Transaction Lines -->
                                <tr t-foreach="lines(data, o)" t-as="line">
                                    <td style="padding: 5px; border: 1px solid #ddd;">
                                        <span t-esc="line['date']"/>
                                    </td>
                                    <td style="padding: 5px; border: 1px solid #ddd;">
                                        <span t-esc="line['invoice_date_due']"/>
                                    </td>
                                    <td style="padding: 5px; border: 1px solid #ddd;">
                                        <span t-esc="line['code']"/>
                                    </td>
                                    <td style="padding: 5px; border: 1px solid #ddd;">
                                        <span t-esc="line['a_name']"/>
                                    </td>
                                    <td style="padding: 5px; border: 1px solid #ddd;">
                                        <span t-esc="line['displayed_name']"/>
                                    </td>
                                    <td style="padding: 5px; border: 1px solid #ddd;">
                                        <span t-esc="line['po_number']"/>
                                    </td>
                                    <td class="text-end" style="padding: 5px; border: 1px solid #ddd;">
                                        <span t-esc="line['debit']"
                                              t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                    </td>
                                    <td class="text-end" style="padding: 5px; border: 1px solid #ddd;">
                                        <span t-esc="line['credit']"
                                              t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                    </td>
                                    <td class="text-end" style="padding: 5px; border: 1px solid #ddd;">
                                        <span t-esc="line['progress']"
                                              t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                    </td>
                                    <td class="text-end" t-if="data['form']['amount_currency']"
                                        style="padding: 5px; border: 1px solid #ddd;">
                                        <t t-if="line['currency_id']">
                                            <span t-esc="line['amount_currency']"
                                                  t-options="{'widget': 'monetary', 'display_currency': line['currency_id']}"/>
                                        </t>
                                    </td>
                                </tr>
                            </tbody>
                        </t>
                    </table>

                    <!-- Custom Footer -->
                    <div class="row" style="margin-top: 30px; border-top: 2px solid #8B1538; padding-top: 15px; page-break-inside: avoid;">
                        <div class="col-6">
                            <small class="text-muted">
                                <strong t-esc="res_company.name"/> |
                                <span t-esc="res_company.phone or ''"/>
                            </small>
                        </div>
                        <div class="col-6 text-end">
                            <small class="text-muted">
                                Generated by <span t-esc="user.name"/> on
                                <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/>
                            </small>
                        </div>
                    </div>

                </t>

            </t>
        </xpath>

    </template>

</odoo>