<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Invoice Form View Inherit -->
    <record id="view_move_form_inherit_direct_invoice" model="ir.ui.view">
        <field name="name">account.move.form.inherit.direct.invoice</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">

            <!-- Add smart button for delivery order -->
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="action_view_delivery"
                        type="object"
                        class="oe_stat_button"
                        icon="fa-truck"
                        invisible="not picking_id"
                        groups="stock.group_stock_user">
                    <field name="picking_id" invisible="1"/>
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_text">Delivery/Return</span>
                    </div>
                </button>
            </xpath>

            <!-- Add checkbox after partner_shipping_id -->
            <xpath expr="//field[@name='partner_shipping_id']" position="after">
                <label for="create_delivery"
                       string="ðŸšš Auto Create Delivery"
                       invisible="move_type not in ['out_invoice', 'out_refund']"/>
                <div invisible="move_type not in ['out_invoice', 'out_refund']">
                    <field name="create_delivery"
                           widget="boolean_toggle"
                           nolabel="1"/>
                    <div class="text-muted" invisible="not create_delivery">
                        <small>
                            â€¢ Invoice: Creates delivery &amp; reduces stock<br/>
                            â€¢ Credit Note: Creates return &amp; adds stock back<br/>
                            â€¢ Set warehouse per line below for multi-warehouse
                        </small>
                    </div>
                </div>
            </xpath>

            <!-- Add default warehouse field -->
            <xpath expr="//field[@name='create_delivery']" position="after">
                <field name="warehouse_id"
                       invisible="not create_delivery or move_type not in ['out_invoice', 'out_refund']"
                       options="{'no_create': True, 'no_open': True}"
                       placeholder="Default warehouse (if lines don't specify)"
                       string="Default Warehouse"/>
            </xpath>

            <!-- Add warehouse field to invoice lines (AFTER quantity) -->
            <xpath expr="//field[@name='invoice_line_ids']/list/field[@name='quantity']" position="after">
                <field name="warehouse_id"
                       optional="show"
                       readonly="0"
                       force_save="1"
                       widget="many2one"
                       invisible="parent.move_type not in ['out_invoice', 'out_refund'] or not parent.create_delivery"
                       options="{'no_create': True, 'no_open': True}"/>
            </xpath>

            <!-- Add warehouse field to invoice line form (popup) -->
            <xpath expr="//field[@name='invoice_line_ids']/form//field[@name='quantity']" position="after">
                <field name="warehouse_id"
                       readonly="0"
                       invisible="parent.move_type not in ['out_invoice', 'out_refund'] or not parent.create_delivery"
                       options="{'no_create': True, 'no_open': True}"/>
            </xpath>

        </field>
    </record>

</odoo>





<!--<?xml version="1.0" encoding="utf-8"?>-->
<!--<odoo>-->

<!--    &lt;!&ndash; Invoice Form View Inherit &ndash;&gt;-->
<!--    <record id="view_move_form_inherit_direct_invoice" model="ir.ui.view">-->
<!--        <field name="name">account.move.form.inherit.direct.invoice</field>-->
<!--        <field name="model">account.move</field>-->
<!--        <field name="inherit_id" ref="account.view_move_form"/>-->
<!--        <field name="arch" type="xml">-->

<!--            &lt;!&ndash; Add smart button for delivery order &ndash;&gt;-->
<!--            <xpath expr="//div[@name='button_box']" position="inside">-->
<!--                <button name="action_view_delivery"-->
<!--                        type="object"-->
<!--                        class="oe_stat_button"-->
<!--                        icon="fa-truck"-->
<!--                        invisible="not picking_id"-->
<!--                        groups="stock.group_stock_user">-->
<!--                    <field name="picking_id" invisible="1"/>-->
<!--                    <div class="o_field_widget o_stat_info">-->
<!--                        <span class="o_stat_text">Delivery/Return</span>-->
<!--                    </div>-->
<!--                </button>-->
<!--            </xpath>-->

<!--            &lt;!&ndash; Add checkbox after partner_shipping_id &ndash;&gt;-->
<!--            <xpath expr="//field[@name='partner_shipping_id']" position="after">-->
<!--                <label for="create_delivery"-->
<!--                       string="ðŸšš Auto Create Delivery"-->
<!--                       invisible="move_type not in ['out_invoice', 'out_refund']"/>-->
<!--                <div invisible="move_type not in ['out_invoice', 'out_refund']">-->
<!--                    <field name="create_delivery"-->
<!--                           widget="boolean_toggle"-->
<!--                           nolabel="1"/>-->
<!--                    <div class="text-muted" invisible="not create_delivery">-->
<!--                        <small>-->
<!--                            â€¢ Invoice: Creates delivery &amp; reduces stock<br/>-->
<!--                            â€¢ Credit Note: Creates return &amp; adds stock back-->
<!--                        </small>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </xpath>-->

<!--            &lt;!&ndash; Add warehouse field after create_delivery &ndash;&gt;-->
<!--            <xpath expr="//field[@name='create_delivery']" position="after">-->
<!--                <field name="warehouse_id"-->
<!--                       invisible="not create_delivery or move_type not in ['out_invoice', 'out_refund']"-->
<!--                       options="{'no_create': True, 'no_open': True}"-->
<!--                       placeholder="Auto-selected from Analytic Account"-->
<!--                       string="Warehouse"/>-->
<!--            </xpath>-->

<!--        </field>-->
<!--    </record>-->

<!--</odoo>-->

